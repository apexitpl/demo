apiVersion: source.toolkit.fluxcd.io/v1beta1
kind: HelmRepository
metadata:
  name: go-env
spec:
  interval: 60m
  url: https://damianjaniszewski.github.io/charts
---
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: go-env
spec:
  releaseName: go-env
  chart:
    spec:
      chart: go-env
      sourceRef:
        kind: HelmRepository
        name: go-env
      version: ">=0.0.10"
  values:
    image:
      repository: damianjaniszewski/go-env # {"$imagepolicy": "go-env:go-env:name"}
      tag: 0.0.14 # {"$imagepolicy": "go-env:go-env:tag"}
    replicaCount: 8
    service:
      enabled: true
  interval: 0h0m30s
  install:
    remediation:
      retries: 3
---
apiVersion: image.toolkit.fluxcd.io/v1beta1
kind: ImagePolicy
metadata:
  name: go-env
spec:
  imageRepositoryRef:
    name: go-env
  policy:
    semver:
      range: ">=0.0.0-0"
---
apiVersion: image.toolkit.fluxcd.io/v1beta1
kind: ImageRepository
metadata:
  name: go-env
spec:
  image: damianjaniszewski/go-env
  interval: 1m0s
---
apiVersion: image.toolkit.fluxcd.io/v1beta1
kind: ImageUpdateAutomation
metadata:
  name: image-update-automation
spec:
  interval: 1m0s
  sourceRef:
    kind: GitRepository
    name: flux-sync
    namespace: flux-system
  git:
    checkout:
      ref:
        branch: demo/pge
    commit:
      author:
        email: flux@dev.apexit.pl
        name: Flux
      messageTemplate: 'Auto-release{{range .Updated.Images}} {{ . }}{{end}} in{{range $resource, $_ := .Updated.Objects}} {{ $resource.Kind }}/{{ $resource.Name }}{{end}}'
